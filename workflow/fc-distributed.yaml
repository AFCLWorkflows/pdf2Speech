---
name: "ReadForMe"
dataIns:
- name: "inputFile"
  type: "string"
  source: "inputFile"
- name: "sourceLanguage"
  type: "string"
  source: "sourceLanguage"
- name: "targetLanguage"
  type: "string"
  source: "targetLanguage"

- name: "inputBucket"
  type: "string"
  source: "inputBucket"
- name: "splitBucket"
  type: "string"
  source: "splitBucket"

- name: "extractBucket1"
  type: "string"
  source: "extractBucket1"
- name: "translateBucket1"
  type: "string"
  source: "translateBucket1"

- name: "extractBucket2"
  type: "string"
  source: "extractBucket2"
- name: "translateBucket2"
  type: "string"
  source: "translateBucket2"

- name: "synthesizeBucket"
  type: "string"
  source: "synthesizeBucket"
- name: "outputBucket"
  type: "string"
  source: "outputBucket"

- name: "extractProvider1"
  type: "string"
  source: "extractProvider1"
- name: "translateProvider1"
  type: "string"
  source: "translateProvider1"
- name: "synthesizeProvider1"
  type: "string"
  source: "synthesizeProvider1"

- name: "extractProvider2"
  type: "string"
  source: "extractProvider2"
- name: "translateProvider2"
  type: "string"
  source: "translateProvider2"
- name: "synthesizeProvider2"
  type: "string"
  source: "synthesizeProvider2"
workflowBody:
- function:
    name: "split"
    type: "splitType"
    dataIns:
      - name: "inputFile"
        type: "string"
        source: "ReadForMe/inputFile"
      - name: "inputBucket"
        type: "string"
        source: "ReadForMe/inputBucket"
      - name: "outputBucket"
        type: "string"
        source: "ReadForMe/outputBucket"
    dataOuts:
      - name: "files"
        type: "collection"
      - name: "filesCount"
        type: "number"
    properties:
      - name: "resource"
        value: ""
- parallel:
    name: "parallel"
    dataIns:
      - name: "file"
        type: "string"
        source: "split/files"
      - name: "filesCount"
        type: "number"
        source: "split/filesCount"

      - name: "sourceLanguage"
        type: "string"
        source: "ReadForMe/sourceLanguage"
      - name: "targetLanguage"
        type: "string"
        source: "ReadForMe/targetLanguage"

      - name: "synthesizeBucket"
        type: "string"
        source: "ReadForMe/synthesizeBucket"
      - name: "outputBucket"
        type: "string"
        source: "ReadForMe/outputBucket"

      - name: "extractBucket1"
        type: "string"
        source: "ReadForMe/extractBucket1"
      - name: "translateBucket1"
        type: "string"
        source: "ReadForMe/translateBucket1"

      - name: "extractBucket2"
        type: "string"
        source: "ReadForMe/extractBucket2"
      - name: "translateBucket2"
        type: "string"
        source: "ReadForMe/translateBucket2"

      - name: "extractProvider1"
        type: "string"
        source: "ReadForMe/extractProvider1"
      - name: "translateProvider1"
        type: "string"
        source: "ReadForMe/translateProvider1"
      - name: "synthesizeProvider1"
        type: "string"
        source: "ReadForMe/synthesizeProvider1"

      - name: "extractProvider2"
        type: "string"
        source: "ReadForMe/extractProvider1"
      - name: "translateProvider2"
        type: "string"
        source: "ReadForMe/translateProvider2"
      - name: "synthesizeProvider2"
        type: "string"
        source: "ReadForMe/synthesizeProvider2"

    parallelBody:
      - section:
          - parallelFor:
              name: "parallelFor1"
              dataIns:
                - name: "file"
                  type: "string"
                  source: "parallel/file"
                  constraints:
                    - name: "distribution"
                      value: "BLOCK(1)"
                    - name: "element-index"
                      value: "0:4"
                - name: "sourceLanguage"
                  type: "string"
                  source: "parallel/sourceLanguage"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
                - name: "targetLanguage"
                  type: "string"
                  source: "parallel/targetLanguage"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
                - name: "extractBucket"
                  type: "string"
                  source: "parallel/extractBucket1"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
                - name: "translateBucket"
                  type: "string"
                  source: "parallel/translateBucket1"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
                - name: "synthesizeBucket"
                  type: "string"
                  source: "parallel/synthesizeBucket"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
                - name: "outputBucket"
                  type: "string"
                  source: "parallel/outputBucket"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
                - name: "extractProvider"
                  type: "string"
                  source: "parallel/extractProvider1"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
                - name: "translateProvider"
                  type: "string"
                  source: "parallel/translateProvider1"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
                - name: "synthesizeProvider"
                  type: "string"
                  source: "parallel/synthesizeProvider1"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
              loopCounter:
                from: "0"
                to: "5"
                step: "1"

              loopBody:
                - function:
                    name: "extract1"
                    type: "extractType"
                    dataIns:
                      - name: "inputFile"
                        type: "string"
                        source: "parallelFor1/file"
                      - name: "outputBucket"
                        type: "string"
                        source: "parallelFor1/extractBucket"
                      - name: "provider"
                        type: "string"
                        source: "parallelFor1/extractProvider"
                      - name: "targetLanguage"
                        type: "string"
                        source: "parallelFor1/targetLanguage"
                        passing: true
                      - name: "translateBucket"
                        type: "string"
                        source: "parallelFor1/translateBucket"
                        passing: true
                      - name: "synthesizeBucket"
                        type: "string"
                        source: "parallelFor1/synthesizeBucket"
                        passing: true
                      - name: "translateProvider"
                        type: "string"
                        source: "parallelFor1/translateProvider"
                        passing: true
                      - name: "synthesizeProvider"
                        type: "string"
                        source: "parallelFor1/synthesizeProvider"
                        passing: true
                    dataOuts:
                      - name: "outputFile"
                        type: "string"
                      - name: "targetLanguage"
                        type: "string"
                      - name: "translateBucket"
                        type: "string"
                      - name: "synthesizeBucket"
                        type: "string"
                      - name: "translateProvider"
                        type: "string"
                      - name: "synthesizeProvider"
                        type: "string"
                    properties:
                      - name: "resource"
                        value: ""
                - function:
                    name: "translate1"
                    type: "translateType"
                    dataIns:
                      - name: "inputFile"
                        type: "string"
                        source: "extract1/outputFile"
                      - name: "outputBucket"
                        type: "string"
                        source: "extract1/translateBucket"
                      - name: "language"
                        type: "string"
                        source: "extract1/targetLanguage"
                      - name: "provider"
                        type: "string"
                        source: "extract1/translateProvider"
                      - name: "targetLanguage"
                        type: "string"
                        source: "extract1/targetLanguage"
                        passing: true
                      - name: "synthesizeBucket"
                        type: "string"
                        source: "extract1/synthesizeBucket"
                        passing: true
                      - name: "synthesizeProvider"
                        type: "string"
                        source: "extract1/synthesizeProvider"
                        passing: true
                    dataOuts:
                      - name: "outputFile"
                        type: "string"
                      - name: "targetLanguage"
                        type: "string"
                      - name: "synthesizeBucket"
                        type: "string"
                      - name: "synthesizeProvider"
                        type: "string"
                    properties:
                      - name: "resource"
                        value: "<GOOGLE_FUNCTION_URL>"
                - function:
                    name: "synthesize1"
                    type: "synthesizeType"
                    dataIns:
                      - name: "inputFile"
                        type: "string"
                        source: "translate1/outputFile"
                      - name: "language"
                        type: "string"
                        source: "translate1/targetLanguage"
                      - name: "provider"
                        type: "string"
                        source: "translate1/synthesizeProvider"
                      - name: "outputBucket"
                        type: "string"
                        source: "translate1/synthesizeBucket"
                    dataOuts:
                      - name: "outputFile"
                        type: "string"
                    properties:
                      - name: "resource"
                        value: ""
              dataOuts:
                - name: "audioFiles"
                  type: "collection"
                  source: "synthesize1/outputFile"
                - name: "outputBucket"
                  type: "string"
                  source: "parallelFor1/outputBucket"
              constraints:
                - name: "concurrency"
                  value: "5"

      - section:
          - parallelFor:
              name: "parallelFor2"
              dataIns:
                - name: "file"
                  type: "string"
                  source: "parallel/file"
                  constraints:
                    - name: "distribution"
                      value: "BLOCK(1)"
                    - name: "element-index"
                      value: "5:9"
                - name: "sourceLanguage"
                  type: "string"
                  source: "parallel/sourceLanguage"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
                - name: "targetLanguage"
                  type: "string"
                  source: "parallel/targetLanguage"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
                - name: "extractBucket"
                  type: "string"
                  source: "parallel/extractBucket2"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
                - name: "translateBucket"
                  type: "string"
                  source: "parallel/translateBucket2"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
                - name: "synthesizeBucket"
                  type: "string"
                  source: "parallel/synthesizeBucket"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
                - name: "outputBucket"
                  type: "string"
                  source: "parallel/outputBucket"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
                - name: "extractProvider"
                  type: "string"
                  source: "parallel/extractProvider2"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
                - name: "translateProvider"
                  type: "string"
                  source: "parallel/translateProvider2"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
                - name: "synthesizeProvider"
                  type: "string"
                  source: "parallel/synthesizeProvider2"
                  constraints:
                    - name: "distribution"
                      value: "REPLICATE(*)"
              loopCounter:
                from: "5"
                to: "10"
                step: "1"

              loopBody:
                - function:
                    name: "extract2"
                    type: "extractType"
                    dataIns:
                      - name: "inputFile"
                        type: "string"
                        source: "parallelFor2/file"
                      - name: "outputBucket"
                        type: "string"
                        source: "parallelFor2/extractBucket"
                      - name: "provider"
                        type: "string"
                        source: "parallelFor2/extractProvider"
                      - name: "targetLanguage"
                        type: "string"
                        source: "parallelFor2/targetLanguage"
                        passing: true
                      - name: "translateBucket"
                        type: "string"
                        source: "parallelFor2/translateBucket"
                        passing: true
                      - name: "synthesizeBucket"
                        type: "string"
                        source: "parallelFor2/synthesizeBucket"
                        passing: true
                      - name: "translateProvider"
                        type: "string"
                        source: "parallelFor2/translateProvider"
                        passing: true
                      - name: "synthesizeProvider"
                        type: "string"
                        source: "parallelFor2/synthesizeProvider"
                        passing: true
                    dataOuts:
                      - name: "outputFile"
                        type: "string"
                      - name: "targetLanguage"
                        type: "string"
                      - name: "translateBucket"
                        type: "string"
                      - name: "synthesizeBucket"
                        type: "string"
                      - name: "translateProvider"
                        type: "string"
                      - name: "synthesizeProvider"
                        type: "string"
                    properties:
                      - name: "resource"
                        value: ""
                - function:
                    name: "translate2"
                    type: "translateType"
                    dataIns:
                      - name: "inputFile"
                        type: "string"
                        source: "extract2/outputFile"
                      - name: "outputBucket"
                        type: "string"
                        source: "extract2/translateBucket"
                      - name: "language"
                        type: "string"
                        source: "extract2/targetLanguage"
                      - name: "provider"
                        type: "string"
                        source: "extract2/translateProvider"
                      - name: "targetLanguage"
                        type: "string"
                        source: "extract2/targetLanguage"
                        passing: true
                      - name: "synthesizeBucket"
                        type: "string"
                        source: "extract2/synthesizeBucket"
                        passing: true
                      - name: "synthesizeProvider"
                        type: "string"
                        source: "extract2/synthesizeProvider"
                        passing: true
                    dataOuts:
                      - name: "outputFile"
                        type: "string"
                      - name: "targetLanguage"
                        type: "string"
                      - name: "synthesizeBucket"
                        type: "string"
                      - name: "synthesizeProvider"
                        type: "string"
                    properties:
                      - name: "resource"
                        value: ""
                - function:
                    name: "synthesize2"
                    type: "synthesizeType"
                    dataIns:
                      - name: "inputFile"
                        type: "string"
                        source: "translate2/outputFile"
                      - name: "language"
                        type: "string"
                        source: "translate2/targetLanguage"
                      - name: "provider"
                        type: "string"
                        source: "translate2/synthesizeProvider"
                      - name: "outputBucket"
                        type: "string"
                        source: "translate2/synthesizeBucket"
                    dataOuts:
                      - name: "outputFile"
                        type: "string"
                    properties:
                      - name: "resource"
                        value: ""
              dataOuts:
                - name: "audioFiles"
                  type: "collection"
                  source: "synthesize2/outputFile"
                - name: "outputBucket"
                  type: "string"
                  source: "parallelFor2/outputBucket"
              constraints:
                - name: "concurrency"
                  value: "5"

    dataOuts:
      - name: "audioFiles"
        type: "collection"
        source: "parallelFor1/audioFiles,parallelFor2/audioFiles"
        constraints:
          - name: "aggregation"
            value: "*"
      - name: "outputBucket"
        type: "string"
        source: "parallelFor1/outputBucket"
- function:
    name: "merge"
    type: "mergeType"
    dataIns:
    - name: "inputFiles"
      type: "collection"
      source: "parallel/audioFiles"
    - name: "outputBucket"
      type: "string"
      source: "parallel/outputBucket"
    dataOuts:
    - name: "outputFile"
      type: "string"
    properties:
    - name: "resource"
      value: ""
